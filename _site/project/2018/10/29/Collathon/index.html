<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>Collathon - pkch's Portfolio</title>

  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.2/css/all.css" integrity="sha384-/rXc/GQVaYpyDdyxK+ecHPVYJSN9bmVFBvjA/9eOB+pb3F2w2N6fc5qB9Ew5yIns"
    crossorigin="anonymous">
  <link type="text/css" rel="stylesheet" href="/assets/css/post.css" />
  <link rel="shortcut icon" type="image/x-icon" href="/assets/favicon.ico" />
</head>
<body>
    


<nav id="navbar" class="navbar
  ">
  <div class="title">
    <img class="profile" src="/assets/img/profile.jpg" alt="profile"/>
    <h1 class="main-title"><a href="/">PKCH's Portfolio</a></h1>
  </div>
  <img id="hamburger" src="/assets/img/hamburger.png">
  <div id="menu" class="menu">
    <ul class="categories">
        
          
        
          
        
          
        
          
        
          
        
          
            <li class="category">
              <a class="" href="/category/profile/">profile</a>
            </li>
          
        
          
            <li class="category">
              <a class=" active " href="/category/project/">project</a>
            </li>
          
        
          
            <li class="category">
              <a class="" href="/category/skills/">skills</a>
            </li>
          
        
          
        
          
        
    </ul>
  </div>
</nav>

    <div class="container
      
        container__post
      ">
      <div class="contents">
  <h1>Collathon</h1>
  <p>충남대학교 컴퓨터공학과 모션 동아리에서 주최하는 Collathon 대회 프로젝트</p>

<h2 id="environment">Environment</h2>

<table>
  <thead>
    <tr>
      <th>front-end</th>
      <th>back-end</th>
      <th>DB</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>thymeleaf &amp; jQuery</td>
      <td>Spring boot</td>
      <td>H2</td>
    </tr>
  </tbody>
</table>

<h2 id="member">Member</h2>

<table>
  <thead>
    <tr>
      <th>박경철</th>
      <th>김진현</th>
      <th>정재성</th>
      <th>장종원</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>팀장 &amp; 개발자</td>
      <td>디자이너</td>
      <td>기획자 &amp; 발표</td>
      <td>기획자</td>
    </tr>
  </tbody>
</table>

<h2 id="개발-개요">개발 개요</h2>

<p>펫팸족(Pet+Family) 100만, 반려동물 수 1000만 시대가 도래했다!</p>

<p>1인 가구 증가, 인구 고령화, 혼족 등이 증가함에 따라 취미삼아 기르던 애완동물이 삶을 나누는 반려동물로 인식되며 1인 가구의 필수 가족 구성원으로 자리잡아 가고 있습니다.</p>

<p>반려동물 분양에 대한 관심 또한 크게 증가 하여 반려동물 분양 시 어떤 종의 어떤 브리더에게서 분양 받았으며 어떻게 사는지, 어떤 성격과 어떤 특성의 종이 만나 자신의 반려동물로 되었는지, 아니면 분양 해 주었던 자신의 반려견의 후손들이 어떻게 살고 있는지에 대한 호기심을 갖는 사람들 또한 증가 하고 있습니다.</p>

<p>이에 따라 반려동물의 혈통 및 족보를 추적해주고 지금 현황을 알려주며, 분양까지 알선 해 주는 서비스를 개발하고자 합니다.</p>

<h2 id="db-설계">DB 설계</h2>

<p><img src="/assets/img/project/Collathon/class-diagram.PNG" alt="" /></p>

<h2 id="주요-사용-기능">주요 사용 기능</h2>

<h3 id="jpa--hibernate">JPA &amp; Hibernate</h3>

<p>Java에서 ORM을 지원해주는 JPA에 관심이 많아 실제로 프로젝트에서 사용해보았습니다.</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="code"><pre><span class="nt">&lt;dependency&gt;</span>
   <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
   <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-data-jpa<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></pre></td></tr></tbody></table></code></pre></figure>

<p>위와 같이 의존성을 주입하면 JPA 관련 의존성이 모두 들어옵니다.</p>

<p>이를 사용하여 Entity 설정과 JpaRepository를 활용한 데이터 조작을 할 수 있습니다.</p>

<p>아래는 Users Entity와 Users 데이터 조작을 위한 JpaRepository입니다.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="code"><pre><span class="nd">@Entity</span>
<span class="nd">@Data</span>
<span class="nd">@Validated</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Users</span> <span class="o">{</span>
    <span class="nd">@Id</span> <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"USER_ID"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">email</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">age</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">gender</span><span class="o">;</span>
    <span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"user"</span><span class="o">)</span>
    <span class="nd">@JsonIgnore</span>
    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Pet</span><span class="o">&gt;</span> <span class="n">pets</span><span class="o">;</span>
<span class="o">}</span></pre></td></tr></tbody></table></code></pre></figure>

<p><code class="highlighter-rouge">@Entity</code> 어노테이션으로 Users 클래스를 테이블로 설정합니다. <code class="highlighter-rouge">@Data</code>는 Lombok을 사용한 것으로 자동으로 getter/setter, constructor, toString, hashCode 등을 생성해줍니다.</p>

<p>이렇게 만든 Entity의 데이터를 조작하기 위해 UserRepository라는 인터페이스를 만들고 JpaRepository를 상속받아 사용합니다. 제네릭 변수의 첫번째는 엔티티 객체, 두번째는 primary key의 타입을 적어줍니다.</p>

<p>아래는 UserRepository의 코드입니다.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="code"><pre><span class="nd">@Repository</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">UserRepository</span> <span class="kd">extends</span> <span class="n">JpaRepository</span><span class="o">&lt;</span><span class="n">Users</span><span class="o">,</span> <span class="n">Long</span><span class="o">&gt;</span> <span class="o">{</span>
<span class="o">}</span></pre></td></tr></tbody></table></code></pre></figure>

<h3 id="네이버-아이디로-로그인-api">네이버 아이디로 로그인 API</h3>

<p>네이버 아이디로 로그인 API를 적용하기 위해 <code class="highlighter-rouge">com.github.scribejava.core.builder.api.DefaultApi20</code> 모듈을 가져와 사용하였습니다.</p>

<p>아래는 적용 코드입니다.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">NaverLoginApi</span> <span class="kd">extends</span> <span class="n">DefaultApi20</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">InstanceHolder</span><span class="o">{</span>
        <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">NaverLoginApi</span> <span class="n">INSTANCE</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NaverLoginApi</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="n">NaverLoginApi</span> <span class="nf">instance</span><span class="o">(){</span>
        <span class="k">return</span> <span class="n">InstanceHolder</span><span class="o">.</span><span class="na">INSTANCE</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getAccessTokenEndpoint</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"https://nid.naver.com/oauth2.0/token?grant_type=authorization_code"</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="n">String</span> <span class="nf">getAuthorizationBaseUrl</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"https://nid.naver.com/oauth2.0/authorize"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></pre></td></tr></tbody></table></code></pre></figure>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
</pre></td><td class="code"><pre><span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">NaverLoginBO</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="n">UserRepository</span> <span class="n">userRepository</span><span class="o">;</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">CLIENT_ID</span> <span class="o">=</span> <span class="s">"CLIENT_ID"</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">CLIENT_SECRET</span> <span class="o">=</span> <span class="s">"CLIENT_SECRET"</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">REDIRECT_URL</span> <span class="o">=</span> <span class="s">"http://localhost:8080/callback"</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">SESSION_STATE</span> <span class="o">=</span> <span class="s">"oauth_state"</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">PROFILE_API_URL</span> <span class="o">=</span> <span class="s">"https://openapi.naver.com/v1/nid/me"</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getAuthorizationUrl</span><span class="o">(</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">){</span>

        <span class="n">String</span> <span class="n">state</span> <span class="o">=</span> <span class="n">generateRandomString</span><span class="o">();</span>
        <span class="n">setSession</span><span class="o">(</span><span class="n">session</span><span class="o">,</span> <span class="n">state</span><span class="o">);</span>

        <span class="n">OAuth20Service</span> <span class="n">oAuth</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ServiceBuilder</span><span class="o">()</span>
                <span class="o">.</span><span class="na">apiKey</span><span class="o">(</span><span class="n">CLIENT_ID</span><span class="o">)</span>
                <span class="o">.</span><span class="na">apiSecret</span><span class="o">(</span><span class="n">CLIENT_SECRET</span><span class="o">)</span>
                <span class="o">.</span><span class="na">callback</span><span class="o">(</span><span class="n">REDIRECT_URL</span><span class="o">)</span>
                <span class="o">.</span><span class="na">state</span><span class="o">(</span><span class="n">state</span><span class="o">)</span>
                <span class="o">.</span><span class="na">build</span><span class="o">(</span><span class="n">NaverLoginApi</span><span class="o">.</span><span class="na">instance</span><span class="o">());</span>
        <span class="k">return</span> <span class="n">oAuth</span><span class="o">.</span><span class="na">getAuthorizationUrl</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">OAuth2AccessToken</span> <span class="nf">getAccessToken</span>
    <span class="o">(</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">,</span> <span class="n">String</span> <span class="n">code</span><span class="o">,</span> <span class="n">String</span> <span class="n">state</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">sessionState</span> <span class="o">=</span> <span class="n">getSession</span><span class="o">(</span><span class="n">session</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">sessionState</span><span class="o">,</span> <span class="n">state</span><span class="o">)){</span>
            <span class="n">OAuth20Service</span> <span class="n">oAuth</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ServiceBuilder</span><span class="o">()</span>
                    <span class="o">.</span><span class="na">apiKey</span><span class="o">(</span><span class="n">CLIENT_ID</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">apiSecret</span><span class="o">(</span><span class="n">CLIENT_SECRET</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">callback</span><span class="o">(</span><span class="n">REDIRECT_URL</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">state</span><span class="o">(</span><span class="n">state</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">build</span><span class="o">(</span><span class="n">NaverLoginApi</span><span class="o">.</span><span class="na">instance</span><span class="o">());</span>

            <span class="n">OAuth2AccessToken</span> <span class="n">token</span> <span class="o">=</span> <span class="n">oAuth</span><span class="o">.</span><span class="na">getAccessToken</span><span class="o">(</span><span class="n">code</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">token</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Users</span> <span class="nf">getUserProfile</span><span class="o">(</span><span class="n">OAuth2AccessToken</span> <span class="n">oauthToken</span><span class="o">)</span>
     <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">ObjectMapper</span> <span class="n">mapper</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ObjectMapper</span><span class="o">();</span>
        <span class="n">OAuth20Service</span> <span class="n">oAuthService</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ServiceBuilder</span><span class="o">()</span>
                <span class="o">.</span><span class="na">apiKey</span><span class="o">(</span><span class="n">CLIENT_ID</span><span class="o">)</span>
                <span class="o">.</span><span class="na">apiSecret</span><span class="o">(</span><span class="n">CLIENT_SECRET</span><span class="o">)</span>
                <span class="o">.</span><span class="na">callback</span><span class="o">(</span><span class="n">REDIRECT_URL</span><span class="o">)</span>
                <span class="o">.</span><span class="na">build</span><span class="o">(</span><span class="n">NaverLoginApi</span><span class="o">.</span><span class="na">instance</span><span class="o">());</span>
        <span class="n">OAuthRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OAuthRequest</span><span class="o">(</span><span class="n">Verb</span><span class="o">.</span><span class="na">GET</span><span class="o">,</span> <span class="n">PROFILE_API_URL</span><span class="o">,</span> <span class="n">oAuthService</span><span class="o">);</span>
        <span class="n">oAuthService</span><span class="o">.</span><span class="na">signRequest</span><span class="o">(</span><span class="n">oauthToken</span><span class="o">,</span> <span class="n">request</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">result</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">send</span><span class="o">().</span><span class="na">getBody</span><span class="o">();</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="na">readValue</span><span class="o">(</span><span class="n">result</span><span class="o">,</span>
          <span class="k">new</span> <span class="n">TypeReference</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;&gt;(){});</span>
        <span class="n">Users</span> <span class="n">user</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="na">readValue</span>
        <span class="o">(</span><span class="n">mapper</span><span class="o">.</span><span class="na">writeValueAsString</span><span class="o">(</span><span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"response"</span><span class="o">)),</span><span class="n">Users</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">Long</span> <span class="n">searchId</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
        <span class="k">if</span><span class="o">(!</span><span class="n">userRepository</span><span class="o">.</span><span class="na">existsById</span><span class="o">(</span><span class="n">searchId</span><span class="o">))</span> <span class="n">userRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">user</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="nf">generateRandomString</span><span class="o">(){</span>
        <span class="k">return</span> <span class="n">UUID</span><span class="o">.</span><span class="na">randomUUID</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">setSession</span><span class="o">(</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">,</span> <span class="n">String</span> <span class="n">state</span><span class="o">){</span>
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="n">SESSION_STATE</span><span class="o">,</span> <span class="n">state</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="nf">getSession</span><span class="o">(</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">){</span>
        <span class="k">return</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="n">SESSION_STATE</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span></pre></td></tr></tbody></table></code></pre></figure>

<p>네이버 아이디로 로그인 시 반환값이 Json 형태의 String인데 이를 객체로 만들어 주기 위해
jackson을 사용했습니다.</p>

<p>그리고 만약 가져온 User 값이 DB에 저장되어있다면 그대로 user를 반환해주고 아니라면 DB에 user 정보를 저장하도록 구현했습니다.</p>

<h3 id="aws-s3">AWS S3</h3>

<p>저희 서비스에 애완동물 프로필 사진을 담아야 하는데 담을 저장소를 AWS의 S3 저장소로 설정하는 코드를 작성하였습니다.</p>

<p>아래는 S3 저장소에 업로드하기 위해 AmazonS3Client 클래스를 활용한 코드입니다.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre></td><td class="code"><pre><span class="nd">@RequiredArgsConstructor</span>
<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">S3Uploader</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="n">AmazonS3Client</span> <span class="n">amazonS3Client</span><span class="o">;</span>

    <span class="nd">@Value</span><span class="o">(</span><span class="s">"${cloud.aws.s3.bucket}"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">bucket</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">upload</span><span class="o">(</span><span class="n">MultipartFile</span> <span class="n">multipartFile</span><span class="o">,</span> <span class="n">String</span> <span class="n">dirName</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">File</span> <span class="n">uploadFile</span> <span class="o">=</span> <span class="n">convert</span><span class="o">(</span><span class="n">multipartFile</span><span class="o">).</span><span class="na">orElseThrow</span><span class="o">(()</span>
        <span class="o">-&gt;</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span><span class="s">"MultipartFile -&gt; File로 전환이 실패했습니다."</span><span class="o">));</span>
        <span class="k">return</span> <span class="nf">upload</span><span class="o">(</span><span class="n">uploadFile</span><span class="o">,</span> <span class="n">dirName</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="nf">upload</span><span class="o">(</span><span class="n">File</span> <span class="n">uploadFile</span><span class="o">,</span> <span class="n">String</span> <span class="n">dirName</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">fileName</span> <span class="o">=</span> <span class="n">dirName</span> <span class="o">+</span> <span class="s">"/"</span> <span class="o">+</span> <span class="n">uploadFile</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">uploadImageUrl</span> <span class="o">=</span> <span class="n">putS3</span><span class="o">(</span><span class="n">uploadFile</span><span class="o">,</span> <span class="n">fileName</span><span class="o">);</span>
        <span class="n">removeNewFile</span><span class="o">(</span><span class="n">uploadFile</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">uploadImageUrl</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="nf">putS3</span><span class="o">(</span><span class="n">File</span> <span class="n">uploadFile</span><span class="o">,</span> <span class="n">String</span> <span class="n">fileName</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">amazonS3Client</span><span class="o">.</span><span class="na">putObject</span><span class="o">(</span><span class="k">new</span> <span class="n">PutObjectRequest</span><span class="o">(</span><span class="n">bucket</span><span class="o">,</span> <span class="n">fileName</span><span class="o">,</span> <span class="n">uploadFile</span><span class="o">)</span>
        <span class="o">.</span><span class="na">withCannedAcl</span><span class="o">(</span><span class="n">CannedAccessControlList</span><span class="o">.</span><span class="na">PublicRead</span><span class="o">));</span>
        <span class="k">return</span> <span class="n">amazonS3Client</span><span class="o">.</span><span class="na">getUrl</span><span class="o">(</span><span class="n">bucket</span><span class="o">,</span> <span class="n">fileName</span><span class="o">).</span><span class="na">toString</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">removeNewFile</span><span class="o">(</span><span class="n">File</span> <span class="n">targetFile</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">targetFile</span><span class="o">.</span><span class="na">delete</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">Optional</span><span class="o">&lt;</span><span class="n">File</span><span class="o">&gt;</span> <span class="nf">convert</span><span class="o">(</span><span class="n">MultipartFile</span> <span class="n">file</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">File</span> <span class="n">convertFile</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">file</span><span class="o">.</span><span class="na">getOriginalFilename</span><span class="o">());</span>
        <span class="k">if</span><span class="o">(</span><span class="n">convertFile</span><span class="o">.</span><span class="na">createNewFile</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">(</span><span class="n">FileOutputStream</span> <span class="n">fos</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileOutputStream</span><span class="o">(</span><span class="n">convertFile</span><span class="o">))</span> <span class="o">{</span>
                <span class="n">fos</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">file</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="n">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">convertFile</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">Optional</span><span class="o">.</span><span class="na">empty</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span></pre></td></tr></tbody></table></code></pre></figure>

<h2 id="구현-기능">구현 기능</h2>

<h3 id="로그인-및-로그아웃">로그인 및 로그아웃</h3>

<p>저희 프로젝트의 로그인은 네이버 로그인으로만 가능하게 설정하였습니다. <code class="highlighter-rouge">com.github.scribejava.core.builder.api.DefaultApi20</code> 모듈로 API를 적용하여 로그인을 구현하였습니다.</p>

<p>로그아웃의 경우 <code class="highlighter-rouge">/logout</code>으로 요청이 들어오면 session 값을 비워서 구현하였습니다.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="code"><pre><span class="kd">public</span> <span class="n">String</span> <span class="nf">logout</span><span class="o">(</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">){</span>
    <span class="n">session</span><span class="o">.</span><span class="na">invalidate</span><span class="o">();</span>
    <span class="k">return</span> <span class="s">"redirect:/"</span><span class="o">;</span>
<span class="o">}</span></pre></td></tr></tbody></table></code></pre></figure>

<h3 id="애완동물-검색기능">애완동물 검색기능</h3>

<p>애완동물 정보로는 동물종류, 품종, 이름 등이 있습니다. 검색은 동물종류, 품종, 이름으로 할 수 있도록 구현했습니다.</p>

<p>form에서 method값으로 검색 방법(동물종류, 품종, 이름 중 하나)과 query로 검색자가 검색하려는 문자를 보내 검색을 실행합니다.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="code"><pre><span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Pet</span><span class="o">&gt;</span> <span class="nf">searchPets</span><span class="o">(</span><span class="n">String</span> <span class="n">method</span><span class="o">,</span> <span class="n">String</span> <span class="n">query</span><span class="o">){</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Pet</span><span class="o">&gt;</span> <span class="n">searchResult</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">method</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"name"</span><span class="o">))</span> <span class="n">searchResult</span> <span class="o">=</span> <span class="n">petRepository</span><span class="o">.</span><span class="na">findByNameLike</span><span class="o">(</span><span class="n">query</span><span class="o">);</span>
    <span class="k">else</span> <span class="nf">if</span> <span class="o">(</span><span class="n">method</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"category"</span><span class="o">))</span> <span class="n">searchResult</span> <span class="o">=</span> <span class="n">petRepository</span><span class="o">.</span><span class="na">findByCategory</span><span class="o">(</span><span class="n">query</span><span class="o">);</span>
    <span class="k">else</span> <span class="nf">if</span> <span class="o">(</span><span class="n">method</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"breed"</span><span class="o">))</span> <span class="n">searchResult</span> <span class="o">=</span> <span class="n">petRepository</span><span class="o">.</span><span class="na">findByBreed</span><span class="o">(</span><span class="n">query</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">searchResult</span><span class="o">;</span>
<span class="o">}</span></pre></td></tr></tbody></table></code></pre></figure>

<p>위에 각각 method에 맞는 정보를 찾기 위해서 petRepository에 메소드를 추가로 지정해주었습니다.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="code"><pre><span class="nd">@Repository</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">PetRepository</span> <span class="kd">extends</span> <span class="n">JpaRepository</span><span class="o">&lt;</span><span class="n">Pet</span><span class="o">,</span> <span class="n">Long</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="nd">@Query</span><span class="o">(</span><span class="s">"select u from Pet u where u.name like %?1%"</span><span class="o">)</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Pet</span><span class="o">&gt;</span> <span class="nf">findByNameLike</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">);</span> <span class="c1">// 이름 검색</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Pet</span><span class="o">&gt;</span> <span class="nf">findByUserName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">);</span> <span class="c1">// 유저이름 검색</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Pet</span><span class="o">&gt;</span> <span class="nf">findByCategory</span><span class="o">(</span><span class="n">String</span> <span class="n">category</span><span class="o">);</span> <span class="c1">// 분류 검색</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Pet</span><span class="o">&gt;</span> <span class="nf">findByBreed</span><span class="o">(</span><span class="n">String</span> <span class="n">breed</span><span class="o">);</span> <span class="c1">//품종 검색</span>
<span class="o">}</span></pre></td></tr></tbody></table></code></pre></figure>

<h3 id="애완동물-등록-정보수정-이별-기능">애완동물 등록, 정보수정, 이별 기능</h3>

<p>회원이 애완동물을 등록할 수 있도록 합니다. 애완동물정보는 이름, 종류, 품종, 소개글, 사진, 분양여부를 회원에게서 받으며 이름, 종류, 품종은 필수입력정보로 구성하였습니다.</p>

<p>수정은 이름, 종류, 품종과 같은 필수정보를 수정하는 공간, multipart를 이용하여 file을 업로드하기 위한 사진, 소개글, 분양여부를 각각 수정할 수 있는 form을 두어 수정기능을 구현했습니다.</p>

<p>이별은 단순히 DB에서 User와 연관된 Pet을 삭제하는 기능입니다.</p>

<h3 id="이력-등록-기능">이력 등록 기능</h3>

<p>회원이 등록한 팻과의 생활, 좋았던 일 등을 기록하는 기능입니다.</p>

</div>

    </div>
</body>
</html>
